import { UploadFile } from "antd/lib/upload/interface";
import axios, { AxiosResponse } from "axios";

export const getFutureWeather = () =>
  axios.get(
    "https://api.openweathermap.org/data/2.5/onecall?lat=47.282247&lon=-1.521323&exclude=current,minutely,daily,alerts&appid=" +
      process.env.REACT_APP_OPEN_WEATHER_MAP_API_KEY +
      "&units=metric&lang=fr"
  );

export const postNewModelizationForm = ({
  name,
  greenEnergy,
  images,
}: {
  name: string;
  greenEnergy: number;
  images: UploadFile[];
}) => {
  const formData = new FormData();
  formData.append("name", name);
  formData.append("greenEnergy", greenEnergy.toString());
  images.forEach((image) =>
    formData.append("photos", image.originFileObj as Blob)
  );
  return new Promise((resolve, reject) => {
    axios
      .post("http://localhost:7880/submit", formData, {
        headers: { "Content-Type": "multipart/form-data" },
      })
      .then((response) => {
        const submissionID = response.data;
        resolve(submissionID);
      })
      .catch(() => reject());
  });
};

export const getPendingModelizations = (): Promise<
  AxiosResponse<{ id: string; name: string }[]>
> => axios.get("http://localhost:7880//new_submissions");

export const getPendingModelization = (
  modelizationID: string
): Promise<AxiosResponse<PendingModelization>> =>
  axios.get(`http://localhost:7879/job/report/${modelizationID}`);

export const pausePendingModelization = (modelizationID: string) =>
  axios.post(`http://localhost:7879/job/stop/${modelizationID}`);

export const resumePendingModelization = (modelizationID: string) =>
  axios.post(`http://localhost:7879/job/start/${modelizationID}`);

export const getModelizations = (): Promise<AxiosResponse<Modelization[]>> =>
  axios.get("http://localhost:7881/results");

export const getPower = (
  modelizationID: string
): Promise<AxiosResponse<{ power: string }>> =>
  axios.get(`http://localhost:7879/job/power/${modelizationID}`);

export const getModelization = (modelizationID: string | undefined) => {
  return new Promise<Modelization>((resolve) =>
    setTimeout(() => {
      resolve({
        id: 1,
        name: "Sculpture en bronze",
        modelPath: "/scene_dense_mesh_refine_texture.ply",
        texturePath: "/scene_dense_mesh_refine_texture.png",
        power:
          "5.000158536,195.20\n10.000361960,222.22\n15.000543698,213.52\n20.000752115,216.06\n25.000910100,212.00\n30.001059692,337.81\n35.001184038,490.69\n40.001319064,448.40\n45.001438804,627.06\n50.001548107,621.87\n55.001663490,633.81\n60.001775486,606.70\n65.002816032,615.65\n70.002946520,635.98\n75.003056488,592.59\n80.003166006,586.69\n85.003276321,582.81\n90.003390157,586.78\n95.003496783,588.60\n100.003607791,586.05\n105.003713625,584.40\n110.003828514,622.67\n115.003941085,634.28\n120.004053081,601.66\n125.004163576,584.52\n130.004275586,585.00\n135.004386418,589.13\n140.004502602,584.99\n145.004604274,587.38\n150.004714387,585.59\n155.004824377,603.42\n160.004935773,598.34\n165.013336846,589.76\n170.013444279,587.69\n175.013566182,590.16\n180.013677502,601.31\n185.013785799,590.90\n190.013895815,587.58\n195.014001828,595.17\n200.014112611,612.55\n205.014225704,588.92\n210.014344668,592.13\n215.014459397,588.52\n220.014581143,628.06\n225.014694759,631.60\n230.014816334,603.23\n235.014930054,592.49\n240.015517136,584.68\n245.021337309,595.14\n250.021471196,605.45\n255.021615800,637.69\n260.021760117,645.94\n265.021908741,643.62\n270.022045112,643.91\n275.022187101,643.38\n280.022327008,645.02\n285.022472634,644.96\n290.022616764,645.43\n295.022751929,642.12\n300.022901269,633.85\n305.023042471,640.16\n310.023174881,640.21\n315.023287439,606.06\n320.023421300,640.23\n325.023534532,626.58\n330.023646231,637.76\n335.023756898,639.32\n340.023871741,643.07\n345.023983816,642.45\n350.024098056,633.25\n355.024211953,637.30\n360.024322094,628.92\n365.024432723,638.80\n370.024544828,628.61\n375.024656774,644.09\n380.024768783,632.95\n385.024922524,640.39\n390.025035710,628.07\n395.025146732,643.21\n400.025292859,644.85\n405.025411275,624.93\n410.025521038,639.06\n415.025630072,610.82\n420.025772070,636.56\n425.025923885,625.38\n430.026067126,638.77\n435.026188160,638.77\n440.026321333,606.91\n445.026446242,628.67\n450.026572505,631.91\n455.026705532,629.92\n460.026823912,631.28\n465.026946146,625.49\n470.027070720,629.50\n475.027201398,630.20\n480.027355961,617.55\n485.027475745,631.52\n490.027598280,630.77\n495.027720150,629.38\n500.027840071,612.42\n505.027961247,609.48\n510.028100528,641.70\n515.028282038,643.08\n520.028431368,640.39\n525.028606608,641.82\n530.028773897,644.60\n535.029009742,645.01\n540.029148148,644.01\n545.029323409,644.34\n550.029494240,638.48\n555.029638793,641.66\n560.029841209,644.50\n565.030165868,643.96\n570.030333460,638.60\n575.030519637,644.32\n580.030757879,645.12\n585.031018983,642.74\n590.031227851,647.01\n595.031469365,642.48\n600.031643673,639.96\n605.031832593,596.52\n610.032006500,548.60\n615.032188589,545.21\n620.032326372,540.76\n625.032481220,617.57\n630.032695586,537.66\n635.033042436,546.46\n640.033297649,599.19\n645.033446607,566.71\n650.033689459,537.61\n655.033846381,545.51\n660.033982652,619.00\n665.034258643,625.15\n670.034458989,619.10\n675.034657694,629.11\n680.034865340,615.50\n685.035012330,581.13\n690.035155505,611.11\n695.035375932,557.33\n700.035642241,526.44\n705.035936869,603.23\n710.036126344,559.26\n715.036383758,337.33\n720.036548748,183.10\n725.036704196,216.53\n730.036824458,517.63\n735.036937704,582.65\n740.037049889,542.86\n745.037159949,346.21\n750.037262541,562.66\n755.037367354,388.19\n760.037523180,275.17\n765.037656558,486.72\n770.037814957,421.41\n775.037956453,400.84\n780.038090201,487.11\n785.038253301,400.71\n790.038360994,422.19\n795.038514465,459.49\n800.038668007,425.54\n805.038815840,436.40\n810.038957678,437.70\n815.039065771,453.28\n820.039204535,426.56\n825.039390402,444.31\n830.039531530,443.33\n835.039692893,409.40\n840.039820342,443.16\n845.039950659,458.85\n850.040072102,402.97\n855.040193151,401.49\n860.040314647,476.73\n865.040445081,467.24\n870.040612425,377.12\n875.040748325,421.39\n880.040881979,405.75\n885.041017382,405.19\n890.041148809,427.02\n895.041284966,530.98\n900.041461781,626.09\n905.041658499,578.58\n910.041783520,621.67\n915.041918019,634.73\n920.042053364,555.07\n925.042239827,638.89\n930.042364973,617.21\n935.042498264,577.42\n940.042635319,634.78\n945.042781322,572.05\n950.042952000,635.57\n955.043068659,630.18\n960.043190466,617.31\n965.043321018,637.31\n970.043445773,553.48\n975.043585939,639.05\n980.043711672,623.82\n985.043886611,587.81\n990.044017302,638.15\n995.044135475,537.66\n1000.044265381,631.26\n1005.044392623,517.12\n1010.044526502,631.41\n1015.044654006,532.27\n1020.044765403,630.57\n1025.044899259,554.11\n1030.045011773,622.91\n1035.045125964,545.35\n1040.045251490,600.00\n1045.045387030,598.92\n1050.045584714,563.22\n1055.045810631,617.81\n1060.045975958,526.20\n1065.046165646,626.55\n1070.046371916,522.61\n1075.046574507,631.19\n1080.046742461,497.11\n1085.046927239,630.67\n1090.047106361,495.81\n1095.047282616,628.54\n1100.047462485,508.29\n1105.047638250,628.33\n1110.047815062,499.15\n1115.048045644,628.97\n1120.048433796,499.72\n1125.048840811,629.60\n1130.049015291,502.88\n1135.049189432,628.96\n1140.049353821,516.86\n1145.049545767,600.71\n1150.049713735,525.99\n1155.049882953,592.47\n1160.050065287,565.44\n1165.050266398,577.24\n1170.050479909,591.86\n1175.050745077,133.66\n1180.050905444,147.83\n1185.051055186,167.48\n1190.051221072,176.59\n1195.051363508,316.57\n1200.051577510,563.26\n1205.051740106,571.00\n1210.051983701,570.56\n1215.052281120,573.67\n1220.052486599,307.31\n1225.052709249,439.93\n1230.052863295,141.77\n1235.053012067,141.85\n1240.053207491,326.09\n1245.053410325,354.41\n1250.053590134,366.95\n1255.053782388,373.98\n1260.053983094,347.47\n1265.054173180,370.66\n1270.054372859,347.78\n1275.054555783,394.95\n1280.054708522,355.70\n1285.054873256,393.74\n1290.055059855,337.52\n1295.055248665,353.31\n1300.055426958,353.87\n1305.055626203,365.62\n1310.055804873,420.35\n1315.055993658,325.16\n1320.056162369,465.41\n1325.056344545,387.43\n1330.056525230,335.96\n1335.056704240,393.24\n1340.056887325,346.17\n1345.057072084,370.83\n1350.057227622,402.74\n1355.057345585,370.02\n1360.057502067,450.27\n1365.057663179,443.71\n1370.057821665,430.11\n1375.057981519,368.72\n1380.058137271,413.96\n1385.058354838,346.65\n1390.058643431,354.26\n1395.058829882,349.36\n1400.059014090,376.96\n1405.059178255,427.85\n1410.059407421,340.72\n1415.059549661,403.26\n1420.059709416,382.64\n1425.059879487,365.67\n1430.060102964,363.99\n1435.060311245,350.88\n1440.060507866,357.08\n1445.060702787,236.87\n1450.060877394,150.46\n1455.061063700,143.27\n1460.061200463,143.37\n1465.061351494,194.49\n1470.061512583,123.41\n1475.061685904,141.11\n1480.061861062,140.52\n1485.062048598,145.59\n1490.062218881,143.51\n1495.062387655,148.11\n1500.062566774,143.59\n1505.062705962,145.12\n1510.062863553,152.60\n1515.063041846,143.25\n1517.139684668,70.86\n",
      });
    }, 500)
  );
};
